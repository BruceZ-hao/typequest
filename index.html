<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TypeQuest - å•è¯å†’é™©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+SC:wght@400;700;900&display=swap');

        body {
            font-family: 'JetBrains Mono', 'Noto Sans SC', monospace;
            background: #0a0a0f;
            overflow-x: hidden;
        }

        /* åŠ¨æ€èƒŒæ™¯ */
        .cyber-grid {
            background-image: 
                linear-gradient(rgba(0, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* æ»šåŠ¨å®¹å™¨ */
        .scroll-container {
            mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
        }

        /* å•è¯æ ·å¼ */
        .word {
            display: inline-flex;
            margin-right: 2rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .word.completed {
            opacity: 0.3;
            transform: scale(0.9);
        }

        .word.current {
            transform: scale(1.1);
            filter: drop-shadow(0 0 10px rgba(0, 217, 255, 0.5));
        }

        .char {
            display: inline-block;
            transition: all 0.1s;
            position: relative;
        }

        .char.correct {
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88, 0 0 20px #00ff88;
        }

        .char.wrong {
            color: #ff4444;
            text-decoration: underline;
            text-decoration-color: #ff4444;
            animation: shake 0.2s;
        }

        .char.pending {
            color: #4b5563;
        }

        .char.cursor {
            border-bottom: 4px solid #00d9ff;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { border-bottom-color: #00d9ff; }
            51%, 100% { border-bottom-color: transparent; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        /* ä¸­æ–‡ç¿»è¯‘æç¤º */
        .translation {
            position: absolute;
            top: -3rem;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: linear-gradient(135deg, #00d9ff, #0099cc);
            color: #000;
            padding: 0.4rem 1rem;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-family: 'Noto Sans SC', sans-serif;
            font-weight: 800;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 4px 15px rgba(0, 217, 255, 0.4);
            z-index: 10;
        }

        .word.completed .translation {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .translation::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid #00d9ff;
        }

        /* ç²’å­æ•ˆæœ */
        .particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            animation: particleFloat 0.8s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }

        /* è¯ä¹¦é€‰æ‹©å™¨ */
        .book-selector {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding: 0.5rem;
            scrollbar-width: none;
        }

        .book-selector::-webkit-scrollbar {
            display: none;
        }

        .book-btn {
            flex-shrink: 0;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            border: 2px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
            white-space: nowrap;
        }

        .book-btn:hover {
            transform: translateY(-2px);
        }

        .book-btn.active {
            border-color: currentColor;
            box-shadow: 0 0 15px currentColor;
        }

        /* è¿›åº¦æ¡ */
        .progress-glow {
            box-shadow: 0 0 10px currentColor;
        }

        /* æµ®åŠ¨åŠ¨ç”» */
        .float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* éŸ³ä¹æ§åˆ¶ */
        .music-control {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* é€šå…³ç‰¹æ•ˆ */
        .victory-overlay {
            background: radial-gradient(circle, rgba(0,217,255,0.2) 0%, transparent 70%);
        }

        .star {
            position: absolute;
            color: #ffd700;
            font-size: 2rem;
            animation: starPop 0.6s ease-out forwards;
        }

        @keyframes starPop {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(1.5) rotate(180deg); opacity: 1; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }
    </style>
</head>
<body class="min-h-screen text-gray-100 cyber-grid relative">

    <!-- èƒŒæ™¯è£…é¥° -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden">
        <div class="absolute top-20 left-10 w-72 h-72 bg-cyan-500/10 rounded-full blur-3xl float"></div>
        <div class="absolute bottom-20 right-10 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl float" style="animation-delay: -3s;"></div>
    </div>

    <div class="relative z-10 container mx-auto px-4 py-6 max-w-6xl">
        
        <!-- æ ‡é¢˜ -->
        <header class="text-center mb-6">
            <h1 class="text-5xl font-black mb-2 tracking-tighter">
                <span class="bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent" style="filter: drop-shadow(0 0 10px rgba(0,217,255,0.5));">
                    TYPE
                </span>
                <span class="text-white">QUEST</span>
            </h1>
            <p class="text-gray-400 text-sm tracking-widest uppercase">å•è¯å†’é™© Â· 8-bitéŸ³æ•ˆ Â· è¯ä¹¦æŒ‘æˆ˜</p>
        </header>

        <!-- è¯ä¹¦é€‰æ‹© -->
        <div class="mb-6">
            <div class="text-center text-gray-400 text-xs uppercase tracking-wider mb-2">é€‰æ‹©è¯ä¹¦</div>
            <div class="book-selector justify-center">
                <button onclick="selectBook('cet4')" class="book-btn bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 active" data-book="cet4" style="color: #60a5fa;">
                    ğŸ“˜ å››çº§æ ¸å¿ƒ
                </button>
                <button onclick="selectBook('cet6')" class="book-btn bg-purple-500/20 text-purple-400 hover:bg-purple-500/30" data-book="cet6" style="color: #c084fc;">
                    ğŸ“— å…­çº§æ ¸å¿ƒ
                </button>
                <button onclick="selectBook('ielts')" class="book-btn bg-red-500/20 text-red-400 hover:bg-red-500/30" data-book="ielts" style="color: #f87171;">
                    ğŸ“• é›…æ€é«˜é¢‘
                </button>
                <button onclick="selectBook('toefl')" class="book-btn bg-orange-500/20 text-orange-400 hover:bg-orange-500/30" data-book="toefl" style="color: #fb923c;">
                    ğŸ“™ æ‰˜ç¦æ ¸å¿ƒ
                </button>
                <button onclick="selectBook('gre')" class="book-btn bg-green-500/20 text-green-400 hover:bg-green-500/30" data-book="gre" style="color: #4ade80;">
                    ğŸ““ GRE3000
                </button>
                <button onclick="selectBook('programming')" class="book-btn bg-cyan-500/20 text-cyan-400 hover:bg-cyan-500/30" data-book="programming" style="color: #22d3ee;">
                    ğŸ’» ç¼–ç¨‹æœ¯è¯­
                </button>
            </div>
        </div>

        <!-- ç»Ÿè®¡é¢æ¿ -->
        <div class="flex justify-center gap-8 mb-4 text-center">
            <div class="bg-gray-900/50 rounded-xl px-6 py-3 border border-gray-800">
                <div class="text-gray-500 text-xs uppercase tracking-wider mb-1">WPM</div>
                <div id="wpm" class="text-3xl font-bold text-cyan-400 font-mono">0</div>
            </div>
            <div class="bg-gray-900/50 rounded-xl px-6 py-3 border border-gray-800">
                <div class="text-gray-500 text-xs uppercase tracking-wider mb-1">å‡†ç¡®ç‡</div>
                <div id="accuracy" class="text-3xl font-bold text-purple-400 font-mono">100%</div>
            </div>
            <div class="bg-gray-900/50 rounded-xl px-6 py-3 border border-gray-800">
                <div class="text-gray-500 text-xs uppercase tracking-wider mb-1">è¿›åº¦</div>
                <div id="progress-text" class="text-3xl font-bold text-green-400 font-mono">0/0</div>
            </div>
            <div class="bg-gray-900/50 rounded-xl px-6 py-3 border border-gray-800">
                <div class="text-gray-500 text-xs uppercase tracking-wider mb-1">è¿å‡»</div>
                <div id="combo" class="text-3xl font-bold text-yellow-400 font-mono">0</div>
            </div>
        </div>

        <!-- è¿›åº¦æ¡ -->
        <div class="w-full max-w-2xl mx-auto bg-gray-800 rounded-full h-2 mb-6 overflow-hidden">
            <div id="progress-bar" class="h-full bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 w-0 transition-all duration-300 progress-glow"></div>
        </div>

        <!-- æ‰“å­—åŒºåŸŸ -->
        <div class="relative bg-gray-900/80 backdrop-blur border border-gray-700 rounded-2xl p-8 mb-4 overflow-hidden shadow-2xl" style="height: 220px;">
            
            <!-- å¼€å§‹é®ç½© -->
            <div id="startOverlay" class="absolute inset-0 bg-gray-900/95 z-20 flex flex-col items-center justify-center cursor-pointer transition-opacity duration-300">
                <div class="text-6xl mb-3 animate-bounce">ğŸ®</div>
                <h2 class="text-2xl font-bold text-white mb-2">ç‚¹å‡»å¼€å§‹å†’é™©</h2>
                <p class="text-gray-400 text-sm">æŒ‰ç©ºæ ¼é”®æˆ–ç‚¹å‡»æ­¤å¤„å¼€å§‹</p>
                <div class="mt-4 flex gap-2 text-xs text-gray-500">
                    <span class="bg-gray-800 px-3 py-1 rounded-full">ğŸµ èƒŒæ™¯éŸ³ä¹</span>
                    <span class="bg-gray-800 px-3 py-1 rounded-full">ğŸ”Š 8-bitéŸ³æ•ˆ</span>
                </div>
            </div>

            <!-- æ»šåŠ¨è§†å›¾ -->
            <div class="scroll-container w-full h-full flex items-center overflow-hidden relative">
                <div id="textTrack" class="flex items-center whitespace-nowrap transition-transform duration-500 ease-out pl-[50%]">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <input type="text" id="inputField" class="absolute opacity-0 top-0 left-0 w-full h-full cursor-default" autocomplete="off" autocapitalize="off" spellcheck="false">
        </div>

        <!-- å½“å‰å•è¯ä¸­æ–‡ -->
        <div class="text-center mb-6 h-16 flex items-center justify-center">
            <div id="currentTranslation" class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400 opacity-0 transition-all duration-300 transform translate-y-4 font-sans">
                å‡†å¤‡å¼€å§‹...
            </div>
        </div>

        <!-- æ§åˆ¶åŒº -->
        <div class="flex justify-center gap-4 flex-wrap">
            <button onclick="resetGame()" class="group px-6 py-3 bg-gray-800 rounded-xl border border-gray-600 hover:border-cyan-500 hover:text-cyan-400 transition-all flex items-center gap-2">
                <svg class="w-5 h-5 group-hover:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                é‡æ–°å¼€å§‹
            </button>
            
            <button onclick="toggleMusic()" id="musicBtn" class="music-control px-6 py-3 bg-gray-800 rounded-xl border border-gray-600 hover:border-green-500 hover:text-green-400 transition-all flex items-center gap-2">
                <span id="musicIcon">ğŸµ</span>
                <span>éŸ³ä¹å¼€å¯</span>
            </button>
            
            <button onclick="toggleSound()" id="soundBtn" class="px-6 py-3 bg-gray-800 rounded-xl border border-gray-600 hover:border-purple-500 hover:text-purple-400 transition-all flex items-center gap-2">
                <span id="soundIcon">ğŸ”Š</span>
                <span>éŸ³æ•ˆå¼€å¯</span>
            </button>
        </div>
    </div>

    <!-- é€šå…³å¼¹çª— -->
    <div id="victoryModal" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4 victory-overlay">
        <div class="bg-gray-900 border-2 border-cyan-500 rounded-3xl p-8 max-w-md w-full text-center relative overflow-hidden shadow-2xl" style="box-shadow: 0 0 50px rgba(0,217,255,0.3);">
            <div id="starsContainer" class="absolute inset-0 pointer-events-none"></div>
            
            <div class="text-6xl mb-4 animate-bounce">ğŸ†</div>
            <h2 class="text-4xl font-black mb-2 text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500">å…³å¡å®Œæˆ!</h2>
            <p class="text-gray-400 mb-6" id="victoryMessage">å¤ªæ£’äº†ï¼</p>
            
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-gray-800 rounded-xl p-4 border border-gray-700">
                    <div class="text-gray-400 text-sm mb-1">æœ€ç»ˆWPM</div>
                    <div class="text-4xl font-bold text-cyan-400 font-mono" id="finalWPM">0</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-4 border border-gray-700">
                    <div class="text-gray-400 text-sm mb-1">å‡†ç¡®ç‡</div>
                    <div class="text-4xl font-bold text-purple-400 font-mono" id="finalAcc">0%</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-4 border border-gray-700">
                    <div class="text-gray-400 text-sm mb-1">æœ€é«˜è¿å‡»</div>
                    <div class="text-4xl font-bold text-yellow-400 font-mono" id="finalCombo">0</div>
                </div>
                <div class="bg-gray-800 rounded-xl p-4 border border-gray-700">
                    <div class="text-gray-400 text-sm mb-1">è¯„çº§</div>
                    <div class="text-4xl font-bold text-green-400" id="finalRank">S</div>
                </div>
            </div>

            <button onclick="closeVictory()" class="w-full py-4 bg-gradient-to-r from-cyan-500 to-purple-600 rounded-xl font-bold text-white hover:shadow-lg hover:shadow-cyan-500/50 transition-all transform hover:scale-105 text-lg">
                ä¸‹ä¸€å…³ â†’
            </button>
        </div>
    </div>

    <script>
        // ==================== è¯ä¹¦æ•°æ® ====================
        const vocabularyBooks = {
            cet4: [
                { en: "abandon", cn: "æ”¾å¼ƒ" }, { en: "ability", cn: "èƒ½åŠ›" }, { en: "absence", cn: "ç¼ºå¸­" },
                { en: "absolute", cn: "ç»å¯¹çš„" }, { en: "absorb", cn: "å¸æ”¶" }, { en: "abstract", cn: "æŠ½è±¡çš„" },
                { en: "abundant", cn: "ä¸°å¯Œçš„" }, { en: "academic", cn: "å­¦æœ¯çš„" }, { en: "academy", cn: "å­¦é™¢" },
                { en: "accelerate", cn: "åŠ é€Ÿ" }, { en: "accent", cn: "å£éŸ³" }, { en: "acceptance", cn: "æ¥å—" },
                { en: "access", cn: "è¿›å…¥" }, { en: "accident", cn: "äº‹æ•…" }, { en: "accompany", cn: "é™ªä¼´" },
                { en: "accomplish", cn: "å®Œæˆ" }, { en: "accord", cn: "ä¸€è‡´" }, { en: "account", cn: "è´¦æˆ·" },
                { en: "accumulate", cn: "ç§¯ç´¯" }, { en: "accuracy", cn: "å‡†ç¡®" }, { en: "accurate", cn: "ç²¾ç¡®çš„" },
                { en: "accuse", cn: "æ§å‘Š" }, { en: "accustomed", cn: "ä¹ æƒ¯çš„" }, { en: "achievement", cn: "æˆå°±" },
                { en: "acid", cn: "é…¸" }, { en: "acquaintance", cn: "ç†Ÿäºº" }, { en: "acquire", cn: "è·å¾—" },
                { en: "acre", cn: "è‹±äº©" }, { en: "adapt", cn: "é€‚åº”" }, { en: "adequate", cn: "è¶³å¤Ÿçš„" }
            ],
            cet6: [
                { en: "abbreviate", cn: "ç¼©å†™" }, { en: "abnormal", cn: "å¼‚å¸¸çš„" }, { en: "abolish", cn: "åºŸé™¤" },
                { en: "abrupt", cn: "çªç„¶çš„" }, { en: "absurd", cn: "è’è°¬çš„" }, { en: "abundance", cn: "ä¸°å¯Œ" },
                { en: "accessory", cn: "é™„ä»¶" }, { en: "accommodate", cn: "å®¹çº³" }, { en: "acquaint", cn: "ä½¿ç†Ÿæ‚‰" },
                { en: "activate", cn: "æ¿€æ´»" }, { en: "addict", cn: "ä¸Šç˜¾" }, { en: "adequacy", cn: "è¶³å¤Ÿ" },
                { en: "adhere", cn: "åšæŒ" }, { en: "adjacent", cn: "é‚»è¿‘çš„" }, { en: "advocate", cn: "æå€¡" },
                { en: "aesthetic", cn: "ç¾å­¦çš„" }, { en: "affiliate", cn: "é™„å±" }, { en: "affirm", cn: "è‚¯å®š" },
                { en: "afflict", cn: "æŠ˜ç£¨" }, { en: "agenda", cn: "è®®ç¨‹" }, { en: "aggravate", cn: "åŠ é‡" },
                { en: "alleviate", cn: "å‡è½»" }, { en: "ambiguous", cn: "æ¨¡ç³Šçš„" }, { en: "ambitious", cn: "æœ‰é‡å¿ƒçš„" },
                { en: "amend", cn: "ä¿®æ”¹" }, { en: "analogy", cn: "ç±»æ¯”" }, { en: "analytic", cn: "åˆ†æçš„" },
                { en: "ancestor", cn: "ç¥–å…ˆ" }, { en: "anniversary", cn: "å‘¨å¹´" }, { en: "anonymous", cn: "åŒ¿åçš„" }
            ],
            ielts: [
                { en: "abundant", cn: "ä¸°å¯Œçš„" }, { en: "accelerate", cn: "åŠ é€Ÿ" }, { en: "accessible", cn: "å¯è¿›å…¥çš„" },
                { en: "accommodate", cn: "å®¹çº³" }, { en: "accomplishment", cn: "æˆå°±" }, { en: "accumulate", cn: "ç§¯ç´¯" },
                { en: "accurate", cn: "ç²¾ç¡®çš„" }, { en: "achieve", cn: "è¾¾åˆ°" }, { en: "acknowledge", cn: "æ‰¿è®¤" },
                { en: "acquaintance", cn: "ç†Ÿäºº" }, { en: "acquire", cn: "è·å¾—" }, { en: "adequate", cn: "è¶³å¤Ÿçš„" },
                { en: "adjacent", cn: "é‚»è¿‘çš„" }, { en: "adjust", cn: "è°ƒæ•´" }, { en: "administer", cn: "ç®¡ç†" },
                { en: "adolescent", cn: "é’å°‘å¹´" }, { en: "advocate", cn: "æå€¡" }, { en: "aesthetic", cn: "ç¾å­¦çš„" },
                { en: "affluent", cn: "å¯Œè£•çš„" }, { en: "aggregate", cn: "åˆè®¡" }, { en: "aggressive", cn: "ä¾µç•¥çš„" },
                { en: "allocate", cn: "åˆ†é…" }, { en: "alter", cn: "æ”¹å˜" }, { en: "alternative", cn: "æ›¿ä»£çš„" },
                { en: "ambiguous", cn: "æ¨¡ç³Šçš„" }, { en: "ambitious", cn: "æœ‰é‡å¿ƒçš„" }, { en: "analogy", cn: "ç±»æ¯”" },
                { en: "analyze", cn: "åˆ†æ" }, { en: "ancestor", cn: "ç¥–å…ˆ" }, { en: "anniversary", cn: "å‘¨å¹´" }
            ],
            toefl: [
                { en: "abundant", cn: "ä¸°å¯Œçš„" }, { en: "accelerate", cn: "åŠ é€Ÿ" }, { en: "accessible", cn: "å¯è¿›å…¥çš„" },
                { en: "accommodate", cn: "å®¹çº³" }, { en: "accompany", cn: "é™ªä¼´" }, { en: "accomplish", cn: "å®Œæˆ" },
                { en: "accord", cn: "ä¸€è‡´" }, { en: "account", cn: "è´¦æˆ·" }, { en: "accumulate", cn: "ç§¯ç´¯" },
                { en: "accurate", cn: "ç²¾ç¡®çš„" }, { en: "achieve", cn: "è¾¾åˆ°" }, { en: "acknowledge", cn: "æ‰¿è®¤" },
                { en: "acquaint", cn: "ä½¿ç†Ÿæ‚‰" }, { en: "acquire", cn: "è·å¾—" }, { en: "adequate", cn: "è¶³å¤Ÿçš„" },
                { en: "adjacent", cn: "é‚»è¿‘çš„" }, { en: "adjust", cn: "è°ƒæ•´" }, { en: "administer", cn: "ç®¡ç†" },
                { en: "adolescent", cn: "é’å°‘å¹´" }, { en: "advocate", cn: "æå€¡" }, { en: "aesthetic", cn: "ç¾å­¦çš„" },
                { en: "affluent", cn: "å¯Œè£•çš„" }, { en: "aggregate", cn: "åˆè®¡" }, { en: "aggressive", cn: "ä¾µç•¥çš„" },
                { en: "allocate", cn: "åˆ†é…" }, { en: "alter", cn: "æ”¹å˜" }, { en: "alternative", cn: "æ›¿ä»£çš„" },
                { en: "ambiguous", cn: "æ¨¡ç³Šçš„" }, { en: "ambitious", cn: "æœ‰é‡å¿ƒçš„" }, { en: "analogy", cn: "ç±»æ¯”" }
            ],
            gre: [
                { en: "abate", cn: "å‡å°‘" }, { en: "aberrant", cn: "å¼‚å¸¸çš„" }, { en: "abeyance", cn: "ä¸­æ­¢" },
                { en: "abhor", cn: "æ†æ¶" }, { en: "abject", cn: "å‡„æƒ¨çš„" }, { en: "abjure", cn: "å‘èª“æ”¾å¼ƒ" },
                { en: "ablution", cn: "æ²æµ´" }, { en: "abnegate", cn: "å¦è®¤" }, { en: "abolitionist", cn: "åºŸå¥´ä¸»ä¹‰è€…" },
                { en: "abominate", cn: "ç—›æ¨" }, { en: "aboriginal", cn: "åœŸè‘—çš„" }, { en: "abortive", cn: "å¤±è´¥çš„" },
                { en: "abrade", cn: "ç£¨æŸ" }, { en: "abridge", cn: "åˆ å‡" }, { en: "abrogate", cn: "åºŸé™¤" },
                { en: "abscond", cn: "æ½œé€ƒ" }, { en: "absolve", cn: "èµ¦å…" }, { en: "abstain", cn: "æˆ’é™¤" },
                { en: "abstemious", cn: "èŠ‚åˆ¶çš„" }, { en: "abstinent", cn: "ç¦æ¬²çš„" }, { en: "abstracted", cn: "å¿ƒä¸åœ¨ç„‰çš„" },
                { en: "abstruse", cn: "æ·±å¥¥çš„" }, { en: "absurdity", cn: "è’è°¬" }, { en: "abundant", cn: "ä¸°å¯Œçš„" },
                { en: "abuse", cn: "æ»¥ç”¨" }, { en: "abut", cn: "é‚»æ¥" }, { en: "abysmal", cn: "æåçš„" },
                { en: "academic", cn: "å­¦æœ¯çš„" }, { en: "accede", cn: "åŒæ„" }, { en: "accelerate", cn: "åŠ é€Ÿ" }
            ],
            programming: [
                { en: "algorithm", cn: "ç®—æ³•" }, { en: "function", cn: "å‡½æ•°" }, { en: "variable", cn: "å˜é‡" },
                { en: "constant", cn: "å¸¸é‡" }, { en: "database", cn: "æ•°æ®åº“" }, { en: "interface", cn: "æ¥å£" },
                { en: "framework", cn: "æ¡†æ¶" }, { en: "component", cn: "ç»„ä»¶" }, { en: "middleware", cn: "ä¸­é—´ä»¶" },
                { en: "frontend", cn: "å‰ç«¯" }, { en: "backend", cn: "åç«¯" }, { en: "server", cn: "æœåŠ¡å™¨" },
                { en: "client", cn: "å®¢æˆ·ç«¯" }, { en: "network", cn: "ç½‘ç»œ" }, { en: "protocol", cn: "åè®®" },
                { en: "packet", cn: "æ•°æ®åŒ…" }, { en: "router", cn: "è·¯ç”±å™¨" }, { en: "encryption", cn: "åŠ å¯†" },
                { en: "decryption", cn: "è§£å¯†" }, { en: "authentication", cn: "è®¤è¯" }, { en: "authorization", cn: "æˆæƒ" },
                { en: "token", cn: "ä»¤ç‰Œ" }, { en: "session", cn: "ä¼šè¯" }, { en: "cache", cn: "ç¼“å­˜" },
                { en: "memory", cn: "å†…å­˜" }, { en: "storage", cn: "å­˜å‚¨" }, { en: "compile", cn: "ç¼–è¯‘" },
                { en: "runtime", cn: "è¿è¡Œæ—¶" }, { en: "syntax", cn: "è¯­æ³•" }, { en: "debug", cn: "è°ƒè¯•" }
            ]
        };

        // ==================== éŸ³é¢‘ç³»ç»Ÿ ====================
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;
        let soundEnabled = true;
        let musicEnabled = true;
        let musicInterval = null;
        let currentBook = 'cet4';

        // 8-bit éŸ³ä¹åºåˆ—ï¼ˆè¶…çº§é©¬é‡Œå¥¥é£æ ¼ï¼‰
        const musicNotes = [
            { freq: 659.25, duration: 150 }, // E5
            { freq: 659.25, duration: 150 }, // E5
            { freq: 0, duration: 150 },      // rest
            { freq: 659.25, duration: 150 }, // E5
            { freq: 0, duration: 150 },      // rest
            { freq: 523.25, duration: 150 }, // C5
            { freq: 659.25, duration: 150 }, // E5
            { freq: 0, duration: 150 },      // rest
            { freq: 783.99, duration: 150 }, // G5
            { freq: 0, duration: 300 },      // rest
            { freq: 392.00, duration: 150 }, // G4
            { freq: 0, duration: 300 },      // rest
            { freq: 523.25, duration: 150 }, // C5
            { freq: 0, duration: 150 },      // rest
            { freq: 392.00, duration: 150 }, // G4
            { freq: 0, duration: 150 },      // rest
            { freq: 329.63, duration: 150 }, // E4
            { freq: 0, duration: 150 },      // rest
            { freq: 440.00, duration: 150 }, // A4
            { freq: 493.88, duration: 150 }, // B4
            { freq: 466.16, duration: 150 }, // A#4
            { freq: 440.00, duration: 150 }, // A4
            { freq: 0, duration: 150 },      // rest
            { freq: 349.23, duration: 150 }, // F4
            { freq: 392.00, duration: 150 }, // G4
            { freq: 0, duration: 150 },      // rest
            { freq: 329.63, duration: 150 }, // E4
            { freq: 0, duration: 150 },      // rest
            { freq: 293.66, duration: 150 }, // D4
            { freq: 349.23, duration: 150 }, // F4
            { freq: 0, duration: 150 },      // rest
            { freq: 261.63, duration: 150 }, // C4
        ];

        let musicIndex = 0;

        // åˆå§‹åŒ–éŸ³é¢‘
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        // æ’­æ”¾8-bitéŸ³æ•ˆ
        function playSound(type) {
            if (!soundEnabled || !audioCtx) return;

            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            switch(type) {
                case 'key':
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(800, now);
                    osc.frequency.exponentialRampToValueAtTime(400, now + 0.05);
                    gainNode.gain.setValueAtTime(0.1, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
                    osc.start(now);
                    osc.stop(now + 0.05);
                    break;

                case 'jump':
                    // é©¬é‡Œå¥¥è·³è·ƒéŸ³
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(150, now);
                    osc.frequency.linearRampToValueAtTime(300, now + 0.1);
                    osc.frequency.linearRampToValueAtTime(120, now + 0.2);
                    gainNode.gain.setValueAtTime(0.15, now);
                    gainNode.gain.linearRampToValueAtTime(0.01, now + 0.2);
                    osc.start(now);
                    osc.stop(now + 0.2);
                    break;

                case 'coin':
                    // é‡‘å¸éŸ³æ•ˆ
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(987.77, now); // B5
                    osc.frequency.setValueAtTime(1318.51, now + 0.08); // E6
                    gainNode.gain.setValueAtTime(0.1, now);
                    gainNode.gain.setValueAtTime(0.1, now + 0.08);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
                    osc.start(now);
                    osc.stop(now + 0.4);
                    break;

                case 'error':
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(100, now);
                    osc.frequency.linearRampToValueAtTime(50, now + 0.2);
                    gainNode.gain.setValueAtTime(0.2, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                    osc.start(now);
                    osc.stop(now + 0.2);
                    break;

                case 'powerup':
                    // é“å…·å‡çº§éŸ³
                    osc.type = 'square';
                    const notes = [523.25, 659.25, 783.99, 1046.50];
                    notes.forEach((freq, i) => {
                        osc.frequency.setValueAtTime(freq, now + i * 0.1);
                    });
                    gainNode.gain.setValueAtTime(0.15, now);
                    gainNode.gain.linearRampToValueAtTime(0.01, now + 0.4);
                    osc.start(now);
                    osc.stop(now + 0.4);
                    break;

                case 'victory':
                    // é€šå…³èƒœåˆ©éŸ³ä¹ï¼ˆç®€çŸ­ç‰ˆï¼‰
                    playVictoryMusic();
                    break;
            }
        }

        // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
        function playBackgroundMusic() {
            if (!musicEnabled || !audioCtx) return;
            
            const note = musicNotes[musicIndex];
            if (note.freq > 0) {
                const osc = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                osc.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                osc.type = 'square';
                osc.frequency.setValueAtTime(note.freq, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + note.duration / 1000);
                
                osc.start(audioCtx.currentTime);
                osc.stop(audioCtx.currentTime + note.duration / 1000);
            }
            
            musicIndex = (musicIndex + 1) % musicNotes.length;
        }

        // å¼€å§‹èƒŒæ™¯éŸ³ä¹å¾ªç¯
        function startMusic() {
            if (musicInterval) clearInterval(musicInterval);
            musicInterval = setInterval(playBackgroundMusic, 150);
        }

        // åœæ­¢èƒŒæ™¯éŸ³ä¹
        function stopMusic() {
            if (musicInterval) {
                clearInterval(musicInterval);
                musicInterval = null;
            }
        }

        // é€šå…³èƒœåˆ©éŸ³ä¹
        function playVictoryMusic() {
            if (!audioCtx) return;
            
            const victoryNotes = [
                { f: 523.25, d: 0.1 }, { f: 523.25, d: 0.1 }, { f: 523.25, d: 0.1 },
                { f: 659.25, d: 0.3 }, { f: 783.99, d: 0.1 }, { f: 783.99, d: 0.1 },
                { f: 783.99, d: 0.1 }, { f: 880.00, d: 0.3 }
            ];
            
            let time = audioCtx.currentTime;
            victoryNotes.forEach(note => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                
                osc.type = 'square';
                osc.frequency.setValueAtTime(note.f, time);
                gain.gain.setValueAtTime(0.15, time);
                gain.gain.exponentialRampToValueAtTime(0.01, time + note.d);
                
                osc.start(time);
                osc.stop(time + note.d);
                time += note.d;
            });
        }

        // ==================== æ¸¸æˆé€»è¾‘ ====================
        let words = [];
        let currentWordIndex = 0;
        let currentCharIndex = 0;
        let isPlaying = false;
        let startTime = null;
        let errorCount = 0;
        let totalChars = 0;
        let maxCombo = 0;
        let currentCombo = 0;

        // é€‰æ‹©è¯ä¹¦
        function selectBook(bookKey) {
            currentBook = bookKey;
            
            // æ›´æ–°æŒ‰é’®æ ·å¼
            document.querySelectorAll('.book-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.boxShadow = 'none';
            });
            
            const activeBtn = document.querySelector(`[data-book="${bookKey}"]`);
            activeBtn.classList.add('active');
            
            if (!isPlaying) {
                resetGame();
            }
        }

        // ç”Ÿæˆå•è¯åˆ—è¡¨
        function generateWords() {
            const book = vocabularyBooks[currentBook];
            words = [];
            // éšæœºé€‰æ‹©20ä¸ªå•è¯
            const shuffled = [...book].sort(() => Math.random() - 0.5);
            for (let i = 0; i < 20; i++) {
                words.push(shuffled[i % shuffled.length]);
            }
        }

        // æ¸²æŸ“è½¨é“
        function renderTrack() {
            const track = document.getElementById('textTrack');
            track.innerHTML = '';
            
            words.forEach((wordObj, wordIdx) => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'word';
                wordDiv.id = `word-${wordIdx}`;
                
                // ä¸­æ–‡ç¿»è¯‘æ ‡ç­¾
                const trans = document.createElement('div');
                trans.className = 'translation';
                trans.textContent = wordObj.cn;
                wordDiv.appendChild(trans);
                
                // å­—ç¬¦
                wordObj.en.split('').forEach((char, charIdx) => {
                    const charSpan = document.createElement('span');
                    charSpan.className = 'char pending text-4xl font-bold';
                    charSpan.textContent = char;
                    charSpan.id = `char-${wordIdx}-${charIdx}`;
                    
                    if (wordIdx === 0 && charIdx === 0) {
                        charSpan.classList.add('cursor', 'text-cyan-400');
                        charSpan.classList.remove('pending');
                    }
                    
                    wordDiv.appendChild(charSpan);
                });
                
                track.appendChild(wordDiv);
            });
            
            updateProgress();
        }

        // æ»šåŠ¨åˆ°å½“å‰å•è¯
        function scrollToCurrent() {
            const currentWord = document.getElementById(`word-${currentWordIndex}`);
            if (!currentWord) return;
            
            const track = document.getElementById('textTrack');
            const container = track.parentElement;
            const containerWidth = container.offsetWidth;
            
            const wordOffset = currentWord.offsetLeft;
            const centerOffset = containerWidth / 2 - 150;
            
            track.style.transform = `translateX(${centerOffset - wordOffset}px)`;
            
            // æ›´æ–°åº•éƒ¨ä¸­æ–‡æç¤º
            const transDiv = document.getElementById('currentTranslation');
            if (currentWordIndex < words.length) {
                transDiv.textContent = words[currentWordIndex].cn;
                transDiv.style.opacity = '1';
                transDiv.style.transform = 'translateY(0)';
            }
        }

        // åˆ›å»ºç²’å­
        function createParticle(x, y, color) {
            for (let i = 0; i < 6; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                p.style.width = (4 + Math.random() * 4) + 'px';
                p.style.height = p.style.width;
                p.style.background = color;
                p.style.setProperty('--tx', (Math.random() - 0.5) * 80 + 'px');
                p.style.setProperty('--ty', (Math.random() - 0.5) * 80 + 'px');
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 800);
            }
        }

        // å¤„ç†è¾“å…¥
        function handleInput(e) {
            if (!isPlaying) {
                if (e.code === 'Space') {
                    startGame();
                }
                return;
            }

            const currentWord = words[currentWordIndex];
            const wordEl = document.getElementById(`word-${currentWordIndex}`);

            if (e.key === 'Backspace') {
                if (currentCharIndex > 0) {
                    currentCharIndex--;
                    updateChar(currentWordIndex, currentCharIndex, 'pending');
                    currentCombo = 0;
                    updateCombo();
                }
                return;
            }

            if (e.key === ' ') {
                e.preventDefault();
                if (currentCharIndex === currentWord.en.length) {
                    // å®Œæˆå•è¯
                    wordEl.classList.add('completed');
                    wordEl.classList.remove('current');
                    playSound('coin'); // é‡‘å¸éŸ³æ•ˆ
                    
                    currentCombo++;
                    if (currentCombo > maxCombo) maxCombo = currentCombo;
                    updateCombo();
                    
                    currentWordIndex++;
                    currentCharIndex = 0;
                    
                    if (currentWordIndex < words.length) {
                        updateChar(currentWordIndex, 0, 'current');
                        scrollToCurrent();
                    } else {
                        completeGame();
                    }
                } else {
                    wordEl.classList.add('shake');
                    setTimeout(() => wordEl.classList.remove('shake'), 200);
                    playSound('error');
                    currentCombo = 0;
                    updateCombo();
                }
                return;
            }

            if (e.key.length === 1 && !e.ctrlKey && !e.altKey && !e.metaKey) {
                if (currentCharIndex >= currentWord.en.length) return;
                
                const expected = currentWord.en[currentCharIndex];
                const actual = e.key;
                const charEl = document.getElementById(`char-${currentWordIndex}-${currentCharIndex}`);
                const rect = charEl.getBoundingClientRect();
                
                if (actual === expected) {
                    playSound('key');
                    updateChar(currentWordIndex, currentCharIndex, 'correct');
                    createParticle(rect.left + rect.width/2, rect.top + rect.height/2, '#00ff88');
                    currentCharIndex++;
                    totalChars++;
                    
                    if (currentCharIndex === currentWord.en.length) {
                        wordEl.classList.add('current');
                        document.getElementById('currentTranslation').innerHTML = 
                            `<span class="text-yellow-400">æŒ‰ç©ºæ ¼ç»§ç»­ â†’</span>`;
                    }
                } else {
                    playSound('error');
                    errorCount++;
                    charEl.classList.add('wrong');
                    wordEl.classList.add('shake');
                    setTimeout(() => wordEl.classList.remove('shake'), 200);
                    createParticle(rect.left + rect.width/2, rect.top + rect.height/2, '#ff4444');
                    currentCombo = 0;
                    updateCombo();
                }
                
                updateStats();
            }
        }

        // æ›´æ–°å­—ç¬¦
        function updateChar(wordIdx, charIdx, status) {
            const charEl = document.getElementById(`char-${wordIdx}-${charIdx}`);
            if (!charEl) return;
            
            charEl.className = 'char text-4xl font-bold transition-all';
            
            switch(status) {
                case 'correct':
                    charEl.classList.add('correct');
                    break;
                case 'current':
                    charEl.classList.add('cursor', 'text-cyan-400');
                    break;
                case 'pending':
                    charEl.classList.add('pending');
                    break;
            }
            
            if (status === 'current' && charIdx > 0) {
                const prev = document.getElementById(`char-${wordIdx}-${charIdx-1}`);
                if (prev) prev.classList.remove('cursor');
            }
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const accuracy = totalChars === 0 ? 100 : Math.round(((totalChars - errorCount) / totalChars) * 100);
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            if (startTime) {
                const minutes = (Date.now() - startTime) / 60000;
                const wpm = Math.round((currentWordIndex / minutes)) || 0;
                document.getElementById('wpm').textContent = wpm;
            }
            
            updateProgress();
        }

        // æ›´æ–°è¿å‡»
        function updateCombo() {
            const comboEl = document.getElementById('combo');
            comboEl.textContent = currentCombo;
            if (currentCombo > 5) {
                comboEl.classList.add('text-orange-400');
                comboEl.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    comboEl.style.transform = 'scale(1)';
                }, 200);
            } else {
                comboEl.classList.remove('text-orange-400');
            }
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const progress = (currentWordIndex / words.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `${currentWordIndex}/${words.length}`;
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            initAudio();
            isPlaying = true;
            startTime = Date.now();
            
            if (musicEnabled) startMusic();
            
            const overlay = document.getElementById('startOverlay');
            overlay.style.opacity = '0';
            setTimeout(() => overlay.style.display = 'none', 300);
            
            document.getElementById('inputField').focus();
            scrollToCurrent();
            playSound('powerup');
        }

        // å®Œæˆæ¸¸æˆ
        function completeGame() {
            isPlaying = false;
            stopMusic();
            playSound('victory');
            
            const minutes = (Date.now() - startTime) / 60000;
            const wpm = Math.round((words.length / minutes));
            const accuracy = Math.round(((totalChars - errorCount) / totalChars) * 100);
            
            // è®¡ç®—è¯„çº§
            let rank = 'C';
            let message = 'ç»§ç»­åŠ æ²¹ï¼';
            if (wpm > 100 && accuracy > 95) { rank = 'SSS'; message = 'ç¥çº§æ“ä½œï¼'; }
            else if (wpm > 80 && accuracy > 90) { rank = 'S'; message = 'å®Œç¾é€šå…³ï¼'; }
            else if (wpm > 60 && accuracy > 85) { rank = 'A'; message = 'éå¸¸å‡ºè‰²ï¼'; }
            else if (wpm > 40 && accuracy > 80) { rank = 'B'; message = 'è¡¨ç°ä¸é”™ï¼'; }
            
            document.getElementById('finalWPM').textContent = wpm;
            document.getElementById('finalAcc').textContent = accuracy + '%';
            document.getElementById('finalCombo').textContent = maxCombo;
            document.getElementById('finalRank').textContent = rank;
            document.getElementById('victoryMessage').textContent = message;
            
            // ç”Ÿæˆæ˜Ÿæ˜Ÿç‰¹æ•ˆ
            const starsContainer = document.getElementById('starsContainer');
            starsContainer.innerHTML = '';
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.textContent = 'â­';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    starsContainer.appendChild(star);
                }, i * 100);
            }
            
            document.getElementById('victoryModal').classList.remove('hidden');
        }

        // å…³é—­é€šå…³ç•Œé¢
        function closeVictory() {
            document.getElementById('victoryModal').classList.add('hidden');
            resetGame();
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            isPlaying = false;
            stopMusic();
            currentWordIndex = 0;
            currentCharIndex = 0;
            errorCount = 0;
            totalChars = 0;
            currentCombo = 0;
            maxCombo = 0;
            startTime = null;
            
            document.getElementById('wpm').textContent = '0';
            document.getElementById('accuracy').textContent = '100%';
            document.getElementById('combo').textContent = '0';
            document.getElementById('currentTranslation').textContent = 'å‡†å¤‡å¼€å§‹...';
            document.getElementById('currentTranslation').style.opacity = '0';
            
            const overlay = document.getElementById('startOverlay');
            overlay.style.display = 'flex';
            setTimeout(() => overlay.style.opacity = '1', 10);
            
            generateWords();
            renderTrack();
        }

        // åˆ‡æ¢éŸ³ä¹
        function toggleMusic() {
            musicEnabled = !musicEnabled;
            const btn = document.getElementById('musicBtn');
            const icon = document.getElementById('musicIcon');
            
            if (musicEnabled) {
                icon.textContent = 'ğŸµ';
                btn.classList.remove('opacity-50');
                if (isPlaying) startMusic();
            } else {
                icon.textContent = 'ğŸ”‡';
                btn.classList.add('opacity-50');
                stopMusic();
            }
        }

        // åˆ‡æ¢éŸ³æ•ˆ
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('soundBtn');
            const icon = document.getElementById('soundIcon');
            
            if (soundEnabled) {
                icon.textContent = 'ğŸ”Š';
                btn.classList.remove('opacity-50');
            } else {
                icon.textContent = 'ğŸ”‡';
                btn.classList.add('opacity-50');
            }
        }

        // äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', (e) => {
            if (e.target.id !== 'inputField') {
                document.getElementById('inputField').focus();
            }
            handleInput(e);
        });

        document.getElementById('startOverlay').addEventListener('click', startGame);

        document.addEventListener('click', (e) => {
            if (isPlaying && !e.target.closest('button') && !e.target.closest('#victoryModal')) {
                document.getElementById('inputField').focus();
            }
        });

        // åˆå§‹åŒ–
        generateWords();
        renderTrack();
    </script>
</body>
</html>